add_library(libMobility_PSE SHARED extra/uammd_wrapper.cu)
add_library(PSE.${Python3_SOABI} SHARED python_wrapper.cpp)
# Remove the "lib" prefix from the shared library
set_target_properties(PSE.${Python3_SOABI} PROPERTIES PREFIX "")
target_include_directories(libMobility_PSE PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})
target_link_libraries(libMobility_PSE cufft cublas)
set_target_properties(libMobility_PSE PROPERTIES RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}")
set_target_properties(PSE.${Python3_SOABI} PROPERTIES RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/python")
target_link_libraries(PSE.${Python3_SOABI} libMobility_PSE)
install(TARGETS PSE.${Python3_SOABI} DESTINATION ${Python3_SITEARCH}/libMobility)
install(TARGETS libMobility_PSE DESTINATION ${CMAKE_INSTALL_PREFIX}/lib)
install(FILES ${CMAKE_CURRENT_SOURCE_DIR}/mobility.h DESTINATION ${CMAKE_INSTALL_PREFIX}/include/libMobility/solvers/PSE)
file(GLOB EXTRA_HEADERS extra/*.h)
install(FILES ${EXTRA_HEADERS} DESTINATION ${CMAKE_INSTALL_PREFIX}/include/libMobility/solvers/PSE/extra)
